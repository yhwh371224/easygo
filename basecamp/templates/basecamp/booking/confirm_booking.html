{% extends 'basecamp/base/easygo_base.html' %}
{% block content %}
{% load static %}

<style>
  .hero-confirm {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    overflow: hidden;
  }
  .hero-confirm::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: url("{% static 'basecamp/images/page-title-bg.webp' %}");
    background-size: cover;
    background-position: center center;
    z-index: 0;
  }
  .admin-btn:hover {
    opacity: 0.35 !important;
  }
</style>

<section class="hero-confirm">
  <span class="position-absolute top-0 start-0 w-100 h-100 bg-gradient opacity-80" style="z-index:1;"></span>
  <div class="container py-5" style="position: relative; z-index: 2;">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8">
        <div class="card shadow-lg">
          <form method="post" id="booking-form" action="/confirm_booking_detail/" class="card-body needs-validation p-4 m-3">
            {% csrf_token %}
            {# <input type="text" name="phone_verify" value="" style="display:none !important" tabindex="-1" autocomplete="off"> #}
            <div class="card text-white bg-secondary" style="padding: 2.5rem 3rem;">

              <!-- Email Address Field -->
              <div class="mb-5 pb-3">
                <label class="form-label mb-3">Email address<sup class="text-danger ms-1">*</sup></label>
                <input class="form-control" type="email" placeholder="j.doe@example.com" required name="email">
                <div class="invalid-feedback">Please enter the exact email address you used</div>
              </div>

              <!-- Hidden Index Field -->
              <input type="hidden" id="index" name="index" value="1">

              <!-- Booking Confirmation Field -->
              <div class="mb-0">
                <label class="form-label mb-3">I confirm my booking&nbsp;&nbsp;&nbsp;</label>
                <input type="checkbox" required name="is_confirmed" value="True">
                <div class="invalid-feedback">Please check this box if you want to proceed</div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center mt-4 mb-2">
              <button class="btn btn-primary" type="submit" id="submitButton">Submit</button>
            </div>

            <!-- Admin Access Button -->
            <div class="text-center pt-2">
              <button type="button" id="admin-access-btn" class="btn btn-secondary btn-sm admin-btn" style="opacity: 0.15; font-size: 11px;">
                Admin Access
              </button>
            </div>

            <!-- Admin Fields (hidden initially) -->
            <div class="mb-3 pb-1 d-none" id="admin-fields">
              <label class="form-label text-warning">Admin Use Only â€“ Payment Override</label>

              <!-- Index -->
              <input class="form-control mb-3" type="number" name="index_visible" placeholder="Index (e.g. 1)">

              <!-- Payment Options -->
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" name="cash" id="admin-cash">
                <label class="form-check-label" for="admin-cash">Cash</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="prepay" id="admin-prepay">
                <label class="form-check-label" for="admin-prepay">Prepay</label>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="{% static 'basecamp/js/confirm_booking.js' %}" defer></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("booking-form");
    const submitButton = document.getElementById("submitButton");

    if (form && submitButton) {
        form.addEventListener("submit", function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                form.classList.add('was-validated');
                return;
            }
            submitButton.disabled = true;
            submitButton.innerHTML = "Submitting... <span class='spinner-border spinner-border-sm ms-2'></span>";
        });
    }
});

window.addEventListener("pageshow", function (event) {
    if (event.persisted) {
        const btn = document.getElementById("submitButton");
        if (btn) {
            btn.disabled = false;
            btn.innerHTML = "Submit";
        }
    }
});
</script>

{% endblock %}
