{% extends "easygo_review/base_verse.html" %}

{% block content %}

<style>
/* ... (기존 스타일 유지) ... */
html, body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100%;
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        background-image: url("{{ image_path }}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: white;
        overflow-y: hidden;         /* 스크롤 제거 (텍스트가 넘치면 스크롤이 아닌 폰트 크기 조정) */
    }

    /* 실제 성경 구절 텍스트 */
    .verse-text {
        margin: 0;
        /* 초기 폰트 크기를 vw 대신 vh와 vw를 조합한 min()으로 설정하여 세로 공간도 고려합니다. */
        font-size: min(6vw, 6vh);  /* **변경: 초기 폰트 크기** */ 
        max-width: 90%;
        line-height: 1.3em;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
        padding: 0 10px;
        color: white;
        word-wrap: break-word;
        box-sizing: border-box; /* **추가: 패딩이 너비/높이에 포함되도록** */
        max-height: 100vh; /* **추가: 최대 높이 설정** */
    }

    /* 모바일 대응 */
    @media (max-width: 480px) {
        .verse-text {
            font-size: min(8vw, 8vh); /* **변경: 모바일 폰트 크기를 더 제어** */
            line-height: 1.2em;
        }
    }
</style>

<script>
function fitTextToScreen() {
    const textEl = document.getElementById("verse-text");
    if (!textEl) return;

    setTimeout(() => {
        const parent = textEl.parentElement;
        const paddingFactor = 0.9;
        const parentHeight = parent.clientHeight * paddingFactor;
        const parentWidth  = parent.clientWidth * paddingFactor;

        let fontSize = parseFloat(window.getComputedStyle(textEl).fontSize);
        const step = 0.5;

        while (
            (textEl.scrollHeight > parentHeight ||
            textEl.scrollWidth > parentWidth) &&
            fontSize > 10
        ) {
            fontSize -= step;
            textEl.style.fontSize = fontSize + "px";
        }
    }, 300); // 이미지와 폰트 로드 후 실행 보장
}

window.addEventListener('load', fitTextToScreen);
window.addEventListener('resize', fitTextToScreen);

</script>

{% if image_path %}
<p class="verse-text" id="verse-text">{{ verse_text|linebreaksbr }}</p>
{% else %}
<p>No image available.</p>
{% endif %}

{% endblock %}