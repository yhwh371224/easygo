{% extends "easygo_review/base_verse.html" %}

{% block content %}

<style>
/* ... (기존 스타일 유지) ... */
html, body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100%;
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        background-image: url("{{ image_path }}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: white;
        overflow-y: hidden;         /* 스크롤 제거 (텍스트가 넘치면 스크롤이 아닌 폰트 크기 조정) */
    }

    /* 실제 성경 구절 텍스트 */
    .verse-text {
        margin: 0;
        /* 초기 폰트 크기를 vw 대신 vh와 vw를 조합한 min()으로 설정하여 세로 공간도 고려합니다. */
        font-size: min(6vw, 6vh);  /* **변경: 초기 폰트 크기** */ 
        max-width: 90%;
        line-height: 1.3em;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
        padding: 0 10px;
        color: white;
        word-wrap: break-word;
        box-sizing: border-box; /* **추가: 패딩이 너비/높이에 포함되도록** */
        max-height: 100vh; /* **추가: 최대 높이 설정** */
    }

    /* 모바일 대응 */
    @media (max-width: 480px) {
        .verse-text {
            font-size: min(8vw, 8vh); /* **변경: 모바일 폰트 크기를 더 제어** */
            line-height: 1.2em;
        }
    }
</style>

<script>
function fitTextToScreen() {
    const textEl = document.getElementById("verse-text");
    if (!textEl) return;

    // 부모 요소 (body/html)의 크기
    const parent = textEl.parentElement;
    // 텍스트가 초과하지 않도록 확보할 여백 (예: 10% 여유 공간)
    const paddingFactor = 0.95; 

    // 부모 요소 기준 실제 표시 높이
    const parentHeight = parent.clientHeight * paddingFactor; 
    const parentWidth  = parent.clientWidth * paddingFactor;

    let fontSize = parseFloat(window.getComputedStyle(textEl).fontSize);

    // 폰트 크기를 줄여나가는 단위 (더 공격적인 폰트 축소를 위해 1 대신 0.5로 설정)
    const step = 0.5;

    // 글자가 부모 요소를 넘거나, 부모 요소의 높이보다 클 경우 폰트 줄이기
    // **textEl.scrollHeight**와 **textEl.offsetHeight**를 모두 확인하여 정확도를 높입니다.
    while ((textEl.scrollHeight > parentHeight || textEl.scrollWidth > parentWidth || textEl.offsetHeight > parentHeight) && fontSize > 10) {
        fontSize -= step; // **변경: 폰트 감소 단위를 1에서 0.5로 변경**
        textEl.style.fontSize = fontSize + "px";
        // 텍스트를 줄일 때마다 레이아웃이 다시 계산되도록 합니다. (성능에 영향 가능)
    }
}

// 페이지 로드 시
window.addEventListener('load', fitTextToScreen);
// 화면 회전/크기 변경 시
window.addEventListener('resize', fitTextToScreen);
// 혹시 텍스트 로드 시점이 늦어질 경우를 대비해 DOMContentLoaded에도 추가
document.addEventListener('DOMContentLoaded', fitTextToScreen); 
</script>

{% if image_path %}
<p class="verse-text" id="verse-text">{{ verse_text|linebreaksbr }}</p>
{% else %}
<p>No image available.</p>
{% endif %}

{% endblock %}